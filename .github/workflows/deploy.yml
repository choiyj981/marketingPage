name: ìë™ ë°°í¬

# main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ìë™ìœ¼ë¡œ ì‹¤í–‰
on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: ì„œë²„ì— ìë™ ë°°í¬
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3
    
    - name: SSH í‚¤ ì„¤ì •
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_ed25519
        chmod 600 ~/.ssh/id_ed25519
        ssh-keyscan -H ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts
    
    - name: ì„œë²„ì— ë°°í¬
      run: |
        ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} << 'EOF'
          set -e
          echo "ğŸš€ ë°°í¬ ì‹œì‘..."
          
          # í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
          cd ~/marketingPage
          
          # Gitì—ì„œ ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
          echo "ğŸ“¥ ìµœì‹  ì½”ë“œ ê°€ì ¸ì˜¤ê¸°..."
          git pull origin main
          
          # Docker ì´ë¯¸ì§€ ì¬ë¹Œë“œ ë° ì¬ì‹œì‘
          echo "ğŸ³ Docker ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘..."
          docker-compose -f docker-compose.prod.yml up -d --build
          
          # ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
          echo "âœ… ë°°í¬ ì™„ë£Œ! ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸ ì¤‘..."
          docker-compose -f docker-compose.prod.yml ps
          
          echo "ğŸ‰ ë°°í¬ ì„±ê³µ!"
        EOF
    
    - name: ë°°í¬ ì™„ë£Œ ì•Œë¦¼
      if: success()
      run: |
        echo "âœ… ì„œë²„ ë°°í¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ğŸŒ ì„œë²„ ì£¼ì†Œ: http://34.73.27.245:8080"

