services:
  # PostgreSQL 데이터베이스 컨테이너 (서버 DB 사용으로 주석 처리)
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: marketingpage-db-dev
  #   environment:
  #     POSTGRES_USER: choiyj981
  #     POSTGRES_PASSWORD: 981749
  #     POSTGRES_DB: marketingpage
  #   ports:
  #     - "5432:5432"
  #   volumes:
  #     - postgres_data_dev:/var/lib/postgresql/data
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U choiyj981 -d marketingpage"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #   networks:
  #     - app-network-dev
  #   restart: unless-stopped

  # 애플리케이션 서버 컨테이너 (개발 모드)
  # 소스 코드 변경 시 자동으로 반영됩니다
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: marketingpage-app-dev
    environment:
      # 서버의 PostgreSQL 사용 (34.73.27.245는 서버의 외부 IP)
      DATABASE_URL: postgresql://choiyj981:981749@34.73.27.245:5432/marketingpage
      SESSION_SECRET: dev-secret-key-change-in-production
      PORT: 5000
      NODE_ENV: development
      # 파일 변경 감지 개선을 위한 환경 변수
      CHOKIDAR_USEPOLLING: "true"
      WATCHPACK_POLLING: "true"
    ports:
      - "5000:5000"
    # depends_on 제거 (서버 DB 사용으로 로컬 postgres 의존성 없음)
    volumes:
      # 소스 코드 마운트 (변경 사항 즉시 반영)
      - ./server:/app/server
      - ./client:/app/client
      - ./shared:/app/shared
      - ./public:/app/public
      # 루트 디렉토리의 설정 파일들 마운트
      - ./vite.config.ts:/app/vite.config.ts
      - ./tsconfig.json:/app/tsconfig.json
      - ./tailwind.config.ts:/app/tailwind.config.ts
      - ./postcss.config.js:/app/postcss.config.js
      - ./drizzle.config.ts:/app/drizzle.config.ts
      - ./components.json:/app/components.json
      # node_modules는 컨테이너 내부 것 사용
      - /app/node_modules
      # 업로드된 파일 영구 저장
      - ./public/uploads:/app/public/uploads
    command: npm run dev  # 개발 모드로 실행
    restart: unless-stopped

# volumes:
#   postgres_data_dev:

# networks:
#   app-network-dev:
#     driver: bridge

name: marketingpage-dev

